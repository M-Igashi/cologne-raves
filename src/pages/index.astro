---
import PartyCard from '../components/PartyCard.astro';
import { getFeaturedParties } from '../lib/getFeaturedParties';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

const parties = await getFeaturedParties();

const partiesByDay = parties.reduce((acc, party) => {
  const day = new Date(party.date).toLocaleDateString('en-GB', { weekday: 'long' });
  if (!acc[day]) acc[day] = [];
  acc[day].push(party);
  return acc;
}, {});
---

<html lang="en">
  <head>
    <title>This Week | Cologne Raves</title>
    <meta charset="utf-8" />
  </head>
  <body class="bg-white text-gray-900 font-sans max-w-3xl mx-auto px-4 py-6 sm:px-6 lg:px-8">
    <Header current="thisweek" />

    {Object.entries(partiesByDay).map(([day, dayParties]) => (
      <>
        <h2 class="text-xl font-semibold mt-6 mb-2">{day}</h2>
        <ul class="space-y-4">
          {dayParties.map(party => (
            <li><PartyCard {...party} /></li>
          ))}
        </ul>
      </>
    ))}

    <Footer />
  </body>
</html>
