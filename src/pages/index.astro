---
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import PartyCard from '../components/PartyCard.astro';
import { getFeaturedParties } from '../lib/getFeaturedParties';

const parties = await getFeaturedParties();

// Group parties by weekday
const daysOfWeek = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
const partiesByDay = daysOfWeek.reduce((acc, day) => {
  acc[day] = [];
  return acc;
}, {} as Record<string, typeof parties>);

for (const party of parties) {
  const dayName = daysOfWeek[new Date(party.date).getDay()];
  partiesByDay[dayName].push(party);
}
---

<BaseHead />
<Header />

<main class="max-w-3xl mx-auto px-4">
  <h1 class="text-2xl font-bold mb-4">This Week</h1>

  {daysOfWeek.map((day) => (
    <>
      {partiesByDay[day].length > 0 && (
        <>
          <h2 class="text-lg font-semibold mt-6 mb-2">{day}</h2>
          {partiesByDay[day].map((party) => (
            <PartyCard {...party} />
          ))}
        </>
      )}
    </>
  ))}
</main>

<Footer />