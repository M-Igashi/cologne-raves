---
import { CalendarDays, Clock, MapPin, GitBranch } from 'lucide-react';

interface Props {
  id: string;
  title: string;
  date: string;
  time?: string;
  location?: string;
  artists?: string;
  url?: string;
}

const {
  id,
  title,
  date,
  time,
  location,
  artists,
  url
} = Astro.props;

const shortId = id.startsWith('#') ? id : `#${id.slice(0, 8)}`;
const isoDateTime = new Date(date + (time ? `T${time}` : '')).toISOString();
---

<article class="rounded-xl border p-4 mb-4 relative">
  <div class="absolute top-2 right-4 text-xs text-muted-foreground">{shortId}</div>
  <h2 class="font-semibold">{title}</h2>

  <p class="flex items-center gap-1 mt-1 text-sm text-muted-foreground">
    <CalendarDays class="size-4" />
    {new Date(date).toLocaleDateString('en-US', {
      weekday: 'short',
      day: 'numeric',
      month: 'short',
      year: 'numeric'
    })}
    {time && (
      <>
        {' '}
        – <Clock class="size-4" /> {time}
      </>
    )}
  </p>

  {artists && (
    <p class="flex items-center gap-1 mt-1 text-sm text-muted-foreground">
      <MapPin class="size-4" /> {artists}
    </p>
  )}

  {location && (
    <p class="flex items-center gap-1 mt-1 text-sm text-muted-foreground">
      <GitBranch class="size-4" /> {location}
    </p>
  )}

  {url && (
    <p class="mt-2 text-sm">
      <a
        href={url}
        class="underline underline-offset-2"
        target="_blank"
        rel="noopener noreferrer"
      >
        More Info
      </a>
    </p>
  )}

  <!-- 構造化データ (JSON-LD) -->
  <script type="application/ld+json">
    {JSON.stringify({
      '@context': 'https://schema.org',
      '@type': 'Event',
      name: title,
      startDate: isoDateTime,
      eventAttendanceMode: 'https://schema.org/OfflineEventAttendanceMode',
      eventStatus: 'https://schema.org/EventScheduled',
      location: location
        ? {
            '@type': 'Place',
            name: location
          }
        : undefined,
      performer: artists
        ? artists.split(',').map(name => ({
            '@type': 'PerformingGroup',
            name: name.trim()
          }))
        : undefined,
      url: url || undefined
    })}
  </script>
</article>